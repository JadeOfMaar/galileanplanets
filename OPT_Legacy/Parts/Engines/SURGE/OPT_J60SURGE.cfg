PART:NEEDS[OPT]
{
	// --- general parameters ---
	name = opt_surge
	module = Part
	author = K.Yeon
	tags = opt mk2 deep sky magnet magneto surge plasma jet

	// --- asset parameters ---
	scale = 1
	rescaleFactor = 1
	
	MODEL
	{
		model = DeepSky/DynoTune/SURGE/OPT_J60
	}


	// --- node definitions ---
	node_stack_top = 0.0, 3.99574, 0.0, 0.0, 1.0, 0.0, 3
	node_attach = 1.25, 0.0, 0.0, 0.0, 1.0, 0.0, 4	

	
	// --- editor parameters ---
	TechRequired = experimentalScience
    entryCost = 700000 
    cost = 165000
	category = Engine
	subcategory = 0
	title = OPT-E WarpJet "S.U.R.G.E."
	manufacturer = OPT Propulsion Science Division
	description = The awkward design of this engine when it was first released was a factor to be considered when it bankrupted OPT. Alongside the development of S.C.O.O.P. was the development of WarpJet and its flagship engine, the ScreamJet was revived as the "Sidelong Undulating Respirating Gauss Engine," which generates intense, internal magnetic fields to compress and combust air. Enhanced with S.C.O.O.P., the Surge is able to generate enough thrust on its own to potentially SSTO from any planet.


	// attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision
	attachRules = 1,1,1,1,0


	// --- standard part parameters ---
	mass = 7.2
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	bulkheadProfiles = Mk2
	crashTolerance = 12
	breakingForce = 400
	breakingTorque = 600
	maxTemp = 2900
	emissiveConstant = 1.4 // engine nozzles are good at radiating.

	MODULE
	{
		name = ModuleEnginesFX
		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.03
		minThrust = 0
		maxThrust = 630
		heatProduction = 404
		useEngineResponseTime = True
		engineAccelerationSpeed = 0.2
		engineDecelerationSpeed = 0.4
		useVelocityCurve = False
		flameoutEffectName = flameout
		powerEffectName = running_thrust
		engageEffectName = engage
		disengageEffectName = disengage
		spoolEffectName = running_turbine
		engineSpoolIdle = 0.05
		engineSpoolTime = 2.0
		EngineType = LiquidFuel
		
		PROPELLANT
		{
			name = ElectricCharge
			//resourceFlowMode = STAGE_STACK_FLOW_BALANCE
			ratio = 9
			DrawGauge = True
		}
		
		PROPELLANT
		{
			name = IntakeAtm
			ignoreForIsp = True
			ratio = 2.5
		}
		
		atmosphereCurve
		{
			key = 0 9
			key = 1 7
			key = 5 4
		}
		// Jet params
		atmChangeFlow = True
		useVelCurve = False
		useAtmCurve = True
		//machLimit = 16
		//machHeatMult = 7.0
		
		// No velCurve. Intended isentropic process.
		
		atmCurve
		{
			//Atm pressure vs thrust mult
			key = 0 1.5
			key = 0.05 2.25
			key = 0.2 1.8
			key = 1 1.5
			key = 5 4.5
		}
	}
		
	MODULE
	{
		name = ModuleSurfaceFX
		thrustProviderModuleIndex = 0
		fxMax = 0.6
		maxDistance = 25
		falloff = 2
		thrustTransformName = thrustTransform
	}

	EFFECTS
	{		
		running_thrust
		{			

			PREFAB_PARTICLE
			{
				prefabName = fx_smokeTrail_light
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.25
				speed = 1.0 1.0
				localOffset = 0, 0, 1
				localRotation = 1, 0, 0, -90
			}
////////////////////////////OPTFX/////////////////////////////
			AUDIO
			{
			  channel = Ship
			  clip = sound_explosion_low
			  volume = 0.0 0.0
			  volume = 0.1 1.5
			  volume = 1.0 2
			  pitch = 0.0 0.2
			  pitch = 1.0 1.0
			  loop = true
			}
			
            AUDIO
            {
				name = jetsHumm
                channel = Ship
                clip = OPT/Sounds/engine_1
                volume = 0.45 0.0
				volume = 0.5 0.4
				volume = 0.6 0.8
                volume = 1.0 0.8
				volume = 1.5 0.2
                pitch = 0.0 0.1
                pitch = 0.5 0.2
                pitch = 1.0 0.5
                loop = true
                speed = 0.0 2
                speed = 1.0 3
            }
			
            AUDIO
            {
				name = jetscream
                channel = Ship
                clip = OPT/Sounds/engine_1
                volume = 0.5 0
				volume = 1 1
                volume = 1.2 1.5
				volume = 1.5 2
                pitch = 0.0 0.8
				pitch = 0.5 1
                pitch = 1.0 3
				pitch = 1.7 5
                loop = true
                speed = 0.0 1.70
                speed = 1.5 1.95
            }
			
            AUDIO
            {
				name = jetscreamHighSpeed
                channel = Ship
                clip = OPT/Sounds/engine_2
                volume = 0.0 0
                volume = 0.5 0
                volume = 0.51 1
                volume = 1 3
                pitch = 0.0 0.3
                pitch = 0.5 0.5
                pitch = 1.5 0.7
                pitch = 2 1.5
                loop = true
                speed = 0.0 2
                speed = 0.5 2
                speed = 1.5 3
            }
			
            AUDIO
            {
				name = rocketsound
                channel = Ship
                clip = sound_rocket_mini
                volume = 0.0 0.0
                volume = 1.0 0.8
				volume = 2.7 0.2
                pitch = 0.0 0.2
                pitch = 1.0 0.3
				pitch = 1.7 0.4
                loop = true
            }
			
			MODEL_MULTI_PARTICLE
			{
				name = asdf3
				modelName = Squad/FX/shockExhaust_blue_small
				transformName = FXNode
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 2
				emission = 1.0 3
				speed = 0.0 0.5
				speed = 1.0 1.2
				speed = 3.0 3.2
			}
			
			MODEL_MULTI_PARTICLE
			{
				name = asdf4
				modelName = Squad/FX/shockExhaust_blue_small
				transformName = FXNode1
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 2
				emission = 1.0 3
				speed = 0.0 0.5
				speed = 1.0 1.2
				speed = 3.0 3.2
			}
			
			MODEL_MULTI_PARTICLE
			{
				name = flamethrust
				modelName = OPT_Legacy/FX/RedGreenFlame
				transformName = FXNode
				emission = 0.0 0 0
				emission = 0.9 0
				emission = 1.5 0.9
				emission = 2.75 7
				speed = 0.0 0.4
				speed = 1 0.7
           }
		   
           MODEL_MULTI_PARTICLE
           {
				name = flamethrust1
				modelName = OPT_Legacy/FX/RedGreenFlame
				transformName = FXNode1
				emission = 0.0 0 0
				emission = 0.9 0
				emission = 1.5 0.9
				emission = 2.75 7
				speed = 0.0 0.4
				speed = 1 0.7
			}
		}
////////////////////////////OPTFX==END//////////////////////////		
		running_turbine
		{
			AUDIO
			{
				channel = Ship
				clip = OPT/Sounds/engine_1
				volume = 0.0 0.0
				volume = 0.05 0.4
				volume = 1.0 0.7
				volume = 1.2 1.0
				pitch = 0.0 0.5
				pitch = 0.05 0.6
				pitch = 0.5 2
				pitch = 1.0 1
				loop = true
			}
		}
		
		engage
		{
			AUDIO
			{
				channel = Ship
				clip = DeepSky/DynoTune/Sounds/seismiccharge
				volume = 0.5
				pitch = 1.0
				loop = false
			}
		}
		
		disengage
		{
			AUDIO
			{
				channel = Ship
				clip = DeepSky/DynoTune/Sounds/seismiccharge
				volume = 0.35
				pitch = 1.0
				loop = false
			}
		}
		
		flameout
		{
			PREFAB_PARTICLE
			{
				prefabName = fx_exhaustSparks_flameout_2
				transformName = thrustTransform
				oneShot = true
			}
			
			AUDIO
			{
				channel = Ship
				clip = sound_explosion_low
				volume = 0.8
				pitch = 1.0
				loop = false
			}
		}
	}

	MODULE
	{
		name = FXModuleAnimateThrottle
		animationName = engine_light
		dependOnEngineState = True
		responseSpeed = 0.01
	}
	
	MODULE
	{
		name = ModuleResourceIntake
		resourceName = IntakeAtm
		checkForOxygen = false
		area = 0.0125
		intakeSpeed = 10
		intakeTransformName = intake_transform
		machCurve
		{
			key = 0 0.8 0.002041922 0.002041922
			key = 3.5 2 -0.001022935 -0.001022935
			key = 5 0.8 -0.001022935 -0.001022935
			key = 8 2 -0.001022935 -0.001022935
			key = 11 1.8 -0.001022935 -0.001022935
			key = 16 1.2 -0.001022935 -0.001022935
		}
	}

	RESOURCE
	{
		name = IntakeAtm
		amount = 1
		maxAmount = 200
	}
	
	RESOURCE
	{
		name = ElectricCharge
		amount = 2000
		maxAmount = 2000
	}
	
	MODULE
	{
		name = ModuleLiftingSurface
		useInternalDragModel = False
		deflectionLiftCoeff = 0.7
		dragAtMaxAoA = 0.3
		dragAtMinAoA = 0.1
	}
}